<% layout('/layouts/main.ejs') %>

<style>
  .page-box {
    background: #fff;
    border-radius: 14px;
    padding: 25px;
    box-shadow: 0 5px 18px rgba(0, 0, 0, 0.09);
  }

  .station-card {
    border-radius: 12px;
    background: #f9fafc;
    border: 1px solid #e5e5e5;
    padding: 18px;
    margin-bottom: 16px;
    transition: 0.2s ease;
  }

  .station-card:hover {
    background: #eef7ff;
    border-color: #b5d8ff;
    transform: translateY(-2px);
  }

  .icon-box {
    width: 45px;
    height: 45px;
    background: #e8f3ff;
    color: #007bff;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
  }

  #map {
    height: 350px;
    width: 100%;
    border-radius: 15px;
    border: 1px solid #ddd;
    margin-top: 20px;
  }

  /* Heading row with back button */
  .header-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .back-btn-inline {
    background: #007bff;
    color: white;
    width: 42px;
    height: 42px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 3px 15px rgba(0, 0, 0, 0.15);
    text-decoration: none;
    transition: 0.3s;
  }

  .back-btn-inline:hover {
    background: #0056b3;
    transform: scale(1.05);
  }

  /* Custom SVG arrow (always visible) */
  .back-btn-inline svg {
    width: 20px;
    height: 20px;
    stroke: white;
    stroke-width: 3;
  }
</style>

<div class="container mt-5">
  <div class="page-box">

    <!-- ðŸ”¥ Heading + Back button SAME LINE -->
    <div class="header-row mb-3">
      <h3 class="fw-bold">ðŸ”Œ Charging Stations for this Route.</h3>

      <a class="back-btn-inline" href="javascript:window.history.back();">
        <svg viewBox="0 0 24 24" fill="none">
          <path d="M15 5 L8 12 L15 19" />
        </svg>
      </a>
    </div>

    <p class="mb-4 text-secondary">
      <i class="fa-solid fa-route"></i>
      <span class="fw-bold"><%= start %></span> to
      <span class="fw-bold"><%= end %></span>
    </p>

    <hr />

    <!-- Stations List -->
    <h5 class="fw-bold mb-3">Nearby EV Charging Stations</h5>

    <% if (stations.length === 0) { %>
    <div class="alert alert-danger">
      No charging stations found near the route.
    </div>
    <% } %>

    <% stations.forEach(st => { %>
    <div class="station-card d-flex align-items-center gap-3">
      <div class="icon-box">
        <i class="fa-solid fa-charging-station"></i>
      </div>

      <div>
        <h5 class="mb-1"><%= st.name %></h5>

        <p class="m-0 text-secondary">
          <i class="fa-solid fa-location-dot me-1"></i>
          <%= st.address %>
        </p>

        <p class="m-0 text-secondary">
          <i class="fa-solid fa-road me-1"></i>
          <%= st.distance_km %> km away
        </p>
      </div>
    </div>
    <% }) %>

    <hr class="mt-4" />

    <!-- Map -->
    <h5 class="fw-bold">Map Overview</h5>
    <div id="map"></div>
  </div>
</div>

<!-- Leaflet Map -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
  const map = L.map('map').setView([20.5937, 78.9629], 4);

  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      maxZoom: 18,
  }).addTo(map);

  <% stations.forEach(st => { %>
      L.marker([<%= st.lat %>, <%= st.lng %>]).addTo(map)
          .bindPopup("<b><%= st.name %></b><br><%= st.address %><br><%= st.distance_km %> km");
  <% }) %>

  <% if (stations.length > 0) { %>
      map.setView([<%= stations[0].lat %>, <%= stations[0].lng %>], 9);
  <% } %>
</script>
